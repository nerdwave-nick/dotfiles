context.modules = [
  ##########################################################
  # 3 virtual SINKS (outputs) -> Revolution 2x2 output
  ##########################################################

  { name = libpipewire-module-loopback
    args = {
      node.name        = "loop.primary.out"
      node.description = "Primary bus (out)"

      # This is the virtual sink that apps will see as an output device
      capture.props = {
        node.name        = "virt.primary.sink"
        node.nick        = "Primary Out"
        node.description = "Primary Out"
        media.class      = "Audio/Sink"
        audio.position   = [ FL FR ]

        device.description = "Primary Out"
        device.class     = "sound"
        device.icon-name = "audio-card"
        node.virtual     = false
      }

      # This is the internal stream that feeds the real hardware
      playback.props = {
        node.name        = "virt.primary.sink.playback"
        node.nick        = "Primary HW Out → R2x2"
        node.description = "Primary HW Out → R2x2"
        target.object    = "alsa_output.usb-Black_Lion_Audio_Revolution_2x2_FFFFFFFF-00.pro-output-0"
        node.passive     = true
      }
    }
  }

  { name = libpipewire-module-loopback
    args = {
      node.name        = "loop.comms.out"
      node.description = "Comms bus (out)"

      capture.props = {
        node.name        = "virt.comms.sink"
        node.nick        = "Comms Out"
        node.description = "Comms Out"
        media.class      = "Audio/Sink"
        audio.position   = [ FL FR ]

        device.description = "Comms Out"
        device.class     = "sound"
        device.icon-name = "audio-card"
        node.virtual     = false
      }

      playback.props = {
        node.name        = "virt.comms.sink.playback"
        node.nick        = "Comms HW Out → R2x2"
        node.description = "Comms HW Out → R2x2"
        target.object    = "alsa_output.usb-Black_Lion_Audio_Revolution_2x2_FFFFFFFF-00.pro-output-0"
        node.passive     = true
      }
    }
  }

  { name = libpipewire-module-loopback
    args = {
      node.name        = "loop.secondary.out"
      node.description = "Secondary bus (out)"

      capture.props = {
        node.name        = "virt.secondary.sink"
        node.nick        = "Secondary Out"
        node.description = "Secondary Out"
        media.class      = "Audio/Sink"
        audio.position   = [ FL FR ]

        device.description = "Secondary Out"
        device.class     = "sound"
        device.icon-name = "audio-card"
        node.virtual     = false
      }

      playback.props = {
        node.name        = "virt.secondary.sink.playback"
        node.nick        = "Secondary HW Out → R2x2"
        node.description = "Secondary HW Out → R2x2"
        target.object    = "alsa_output.usb-Black_Lion_Audio_Revolution_2x2_FFFFFFFF-00.pro-output-0"
        node.passive     = true
      }
    }
  }

  ##########################################################
  # 3 virtual SOURCES (inputs) <- Revolution 2x2 input
  ##########################################################

  { name = libpipewire-module-loopback
    args = {
      node.name        = "loop.primary.in"
      node.description = "Primary bus (in)"

      # Internal stream from the hardware input
      capture.props = {
        node.name        = "virt.primary.source.capture"
        node.nick        = "Primary HW In ← R2x2"
        node.description = "Primary HW In ← R2x2"
        target.object    = "alsa_input.usb-Black_Lion_Audio_Revolution_2x2_FFFFFFFF-00.pro-input-0"
        node.passive     = true
      }

      # Virtual source that apps will see as a microphone
      playback.props = {
        node.name        = "virt.primary.source"
        node.nick        = "Primary In"
        node.description = "Primary In"
        media.class      = "Audio/Source"
        audio.position   = [ FL FR ]

        device.description = "Primary In"
        device.class     = "sound"
        device.icon-name = "audio-input-microphone"
        node.virtual     = false
      }
    }
  }

  { name = libpipewire-module-loopback
    args = {
      node.name        = "loop.comms.in"
      node.description = "Comms bus (in)"

      capture.props = {
        node.name        = "virt.comms.source.capture"
        node.nick        = "Comms HW In ← R2x2"
        node.description = "Comms HW In ← R2x2"
        target.object    = "alsa_input.usb-Black_Lion_Audio_Revolution_2x2_FFFFFFFF-00.pro-input-0"
        node.passive     = true
      }

      playback.props = {
        node.name        = "virt.comms.source"
        node.nick        = "Comms In"
        node.description = "Comms In"
        media.class      = "Audio/Source"
        audio.position   = [ FL FR ]

        device.description = "Comms In"
        device.class     = "sound"
        device.icon-name = "audio-input-microphone"
        node.virtual     = false
      }
    }
  }

  { name = libpipewire-module-loopback
    args = {
      node.name        = "loop.secondary.in"
      node.description = "Secondary bus (in)"

      capture.props = {
        node.name        = "virt.secondary.source.capture"
        node.nick        = "Secondary HW In ← R2x2"
        node.description = "Secondary HW In ← R2x2"
        target.object    = "alsa_input.usb-Black_Lion_Audio_Revolution_2x2_FFFFFFFF-00.pro-input-0"
        node.passive     = true
      }

      playback.props = {
        node.name        = "virt.secondary.source"
        node.nick        = "Secondary In"
        node.description = "Secondary In"
        media.class      = "Audio/Source"
        audio.position   = [ FL FR ]

        device.description = "Secondary In"
        device.class     = "sound"
        device.icon-name = "audio-input-microphone"
        node.virtual     = false
      }
    }
  }
]
